{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 3620434619b0e6f5796f","webpack:///./src/index.js"],"names":["thingShadows","isDebug","thingOpsRegister","registeredThings","statusHandler","thingName","opStatus","clientToken","stateObject","console","info","opData","opCb","warn","Error","timeoutHandler","opResponseHandler","opName","resolveCb","rejectCb","log","err","data","ShadowHelper","init","thingShadowInstance","debug","removeListener","on","registerThingAsync","options","Promise","resolve","reject","register","unregisterThing","unregister","getThingAsync","get","updateThingAsync","updateObj","update","deleteThingAsync","delete"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"ShadowHelper\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ShadowHelper\"] = factory();\n\telse\n\t\troot[\"ShadowHelper\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3620434619b0e6f5796f","/**\n * @fileoverview shadow-helper.js\n *\n * ShadowHelper is a wrapper around thingShadow abstraction from aws-iot-device-sdk.\n * It simplifies it's original interface with intuitive Promise based API.\n *\n */\n\nlet thingShadows;\nlet isDebug;\nlet thingOpsRegister = {};\nlet registeredThings = {};\n\n/**\n * Private handler for thingShadow's \"status\" event. It is used to detect the\n * outcome of shadow's operations, and based on that, to resolve or reject a\n * corresponding promise.\n *\n * @param {string} thingName\n * @param {\"accepted\" | \"rejected\"} opStatus\n * @param {string} clientToken\n * @param {Object} stateObject\n *\n * @private\n */\nfunction statusHandler(thingName, opStatus, clientToken, stateObject) {\n  isDebug && console.info('New status received', thingName, opStatus, clientToken, stateObject);\n\n  let opData = thingOpsRegister[clientToken];\n  if (!opData || !opData.opCb) {\n    console.warn('Unknown status message!', clientToken, opData);\n    return;\n  }\n\n  if (opStatus === 'accepted') {\n    opData.opCb(null, stateObject);\n  } else {\n    // rejected\n    opData.opCb(new Error('operation rejected'));\n  }\n}\n\n/**\n * Private handler for thingShadow's \"timeout\" event. It is used to reject a\n * promise for a expired operation.\n *\n * @param {string} thingName\n * @param {string} clientToken\n *\n * @private\n */\nfunction timeoutHandler(thingName, clientToken) {\n  isDebug && console.info('Timeout received', thingName, clientToken);\n\n  let opData = thingOpsRegister[clientToken];\n  if (!opData || !opData.opCb) {\n    console.warn('Unknown operation timeout!',thingName, clientToken);\n    return;\n  }\n  opData.opCb(new Error(`timeout occurred for thing \"${thingName}\" (clientToken=${clientToken})`));\n}\n\n/**\n * Update \"thingOpsRegister\" for a given operation.\n *\n * @param opName\n * @param clientToken\n * @param resolveCb\n * @param rejectCb\n *\n * @private\n */\nfunction opResponseHandler(opName, clientToken, resolveCb, rejectCb) {\n  if (!clientToken) {\n    isDebug && console.warn(`${opName} operation cannot be performed now`);\n    rejectCb(new Error('operation in progress or thingShadow not registered'));\n    return;\n  }\n\n  if (thingOpsRegister[clientToken]) {\n    isDebug && console.log(`Detected duplicate item in thing operations register (${clientToken})`);\n    let opData = thingOpsRegister[clientToken];\n    if (typeof opData.opCb === 'function') opData.opCb(new Error('duplicate client token detected'));\n    thingOpsRegister[clientToken] = null;\n  }\n\n  thingOpsRegister[clientToken] = {\n    opCb: function (err, data) {\n      delete thingOpsRegister[clientToken];\n      if (err) return rejectCb(err);\n      resolveCb(data);\n    }\n  };\n}\n\nconst ShadowHelper = {\n\n  /**\n   * Initialize ShadowHelper singleton.\n   *\n   * @param {awsIot.thingShadow} thingShadowInstance\n   * @param {boolean} debug - enables additional logging\n   */\n  init(thingShadowInstance, debug=false) {\n    isDebug = debug;\n\n    if (thingShadows) {\n      thingShadows.removeListener('status', statusHandler);\n      thingShadows.removeListener('timeout', timeoutHandler);\n    }\n\n    thingShadows = thingShadowInstance;\n    thingOpsRegister = {};\n    thingShadows.on('status', statusHandler);\n    thingShadows.on('timeout', timeoutHandler);\n  },\n\n  /**\n   * Wrapper around thingShadow's register API. It extends it a bit. Now, it is\n   * transparent if a Thing is already registered or not. Original API doesn't\n   * call a callback if Thing is already registered and there is no way to detect\n   * if a Thing is registered or not.\n   *\n   * @param {string} thingName\n   * @param {Object=} options\n   * @return {Promise}\n   */\n  registerThingAsync(thingName, options={}) {\n    if (!thingShadows) throw Error('ShadowHelper not initialized');\n\n    return new Promise((resolve, reject) => {\n      if (registeredThings[thingName]) {\n        resolve();\n        return;\n      }\n\n      thingShadows.register(thingName, options, () => {\n        registeredThings[thingName] = true;\n        resolve();\n      });\n    });\n  },\n\n  /**\n   * If Things are registered with \"registerThingAsync\", this method has to be\n   * used to unregister it.\n   *\n   * @param thingName\n   */\n  unregisterThing(thingName) {\n    delete registeredThings[thingName];\n    thingShadows.unregister(thingName);\n  },\n\n  /**\n   * Promise based wrapper around shadowThing's \"get\" API.\n   *\n   * @param {string} thingName\n   * @return {Promise}\n   */\n  getThingAsync(thingName) {\n    if (!thingShadows) throw Error('ShadowHelper not initialized');\n    isDebug && console.info(`ShadowHelper->getThingAsync(${thingName})`);\n\n    return new Promise((resolve, reject) => {\n      let clientToken = thingShadows.get(thingName);\n      opResponseHandler('get', clientToken, resolve, reject);\n    });\n  },\n\n  /**\n   * Promise based wrapper around shadowThing's \"update\" API.\n   *\n   * @param {string} thingName\n   * @param {Object} updateObj\n   * @return {Promise}\n   */\n  updateThingAsync(thingName, updateObj) {\n    if (!thingShadows) throw Error('ShadowHelper not initialized');\n    isDebug && console.info(`ShadowHelper->updateThingAsync(${thingName})`);\n\n    return new Promise((resolve, reject) => {\n      let clientToken = thingShadows.update(thingName, updateObj);\n      opResponseHandler('update', clientToken, resolve, reject);\n    });\n  },\n\n  /**\n   * Promise based wrapper around shadowThing's \"delete\" API.\n   *\n   * @param {string} thingName\n   * @return {Promise}\n   */\n  deleteThingAsync(thingName) {\n    if (!thingShadows) throw Error('ShadowHelper not initialized');\n    isDebug && console.info(`ShadowHelper->deleteThingAsync(${thingName})`);\n\n    return new Promise((resolve, reject) => {\n      let clientToken = thingShadows.delete(thingName);\n      opResponseHandler('delete', clientToken, resolve, reject);\n    });\n  }\n\n};\n\nexport default ShadowHelper;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}